# æ™ºèƒ½å‚æ•°æ¨èç³»ç»Ÿè®¾è®¡æ–‡æ¡£

## 1. æ¦‚è¿°

æ™ºèƒ½å‚æ•°æ¨èç³»ç»Ÿæ˜¯ Stellar Profile åˆ†æå™¨çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œæ—¨åœ¨æ ¹æ®æŸ¥è¯¢ç‰¹å¾ã€é›†ç¾¤é…ç½®å’Œå½“å‰å‚æ•°è®¾ç½®ï¼ŒåŠ¨æ€ç”Ÿæˆä¸ªæ€§åŒ–çš„å‚æ•°è°ƒä¼˜å»ºè®®ã€‚

### 1.1 è®¾è®¡ç›®æ ‡

- **æ™ºèƒ½åŒ–**ï¼šæ ¹æ®å®é™…æŸ¥è¯¢ç‰¹å¾åŠ¨æ€è®¡ç®—æ¨èå€¼ï¼Œè€Œéé™æ€ç¡¬ç¼–ç 
- **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**ï¼šè€ƒè™‘é›†ç¾¤é…ç½®ï¼ˆBE æ•°é‡ï¼‰ã€æ•°æ®é‡ã€å½“å‰å‚æ•°è®¾ç½®ç­‰å› ç´ 
- **é¿å…å†—ä½™**ï¼šå½“å‰å€¼å·²æ»¡è¶³æ¨èæ¡ä»¶æ—¶ï¼Œä¸ç”Ÿæˆé‡å¤å»ºè®®
- **å¯è§£é‡Šæ€§**ï¼šæ¯ä¸ªæ¨èéƒ½é™„å¸¦åŠ¨æ€ç”Ÿæˆçš„ç†ç”±è¯´æ˜

### 1.2 ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Profile åˆ†æå™¨                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚  â”‚  Handler å±‚       â”‚                                               â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                                               â”‚
â”‚  â”‚  â”‚ è·å–é›†ç¾¤å˜é‡  â”‚ â”‚  SHOW VARIABLES WHERE Variable_name IN (...) â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚           â”‚ ClusterVariables                                        â”‚
â”‚           â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   è§„åˆ™å¼•æ“        â”‚â”€â”€â”€â–¶â”‚  è¯Šæ–­è§„åˆ™   â”‚â”€â”€â”€â–¶â”‚ æ™ºèƒ½å‚æ•°æ¨èç³»ç»Ÿ  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                     â”‚                    â”‚               â”‚
â”‚           â–¼                     â–¼                    â–¼               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ClusterInfo â”‚    â”‚   RuleContext    â”‚    â”‚ suggest_parameter â”‚   â”‚
â”‚  â”‚ - backend_num    â”‚ - node           â”‚    â”‚ _smart()          â”‚   â”‚
â”‚  â”‚ - scan_bytesâ”‚    â”‚ - session_vars   â”‚    â”‚                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ - cluster_info   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                     â”‚ - cluster_vars â—€â”€â”¼â”€â”€ ä¼˜å…ˆä½¿ç”¨é›†ç¾¤å®é™…å€¼       â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. æ ¸å¿ƒæ•°æ®ç»“æ„

### 2.1 ClusterInfo - é›†ç¾¤ä¿¡æ¯

ä» Profile ä¸­æå–çš„é›†ç¾¤é…ç½®ä¿¡æ¯ï¼Œç”¨äºæ™ºèƒ½æ¨èè®¡ç®—ã€‚

```rust
pub struct ClusterInfo {
    /// å‚ä¸æŸ¥è¯¢çš„ BE èŠ‚ç‚¹æ•°é‡
    pub backend_num: u32,
    /// Fragment å®ä¾‹æ€»æ•°ï¼ˆé¢„ç•™ï¼‰
    pub instance_num: u32,
    /// æ‰€æœ‰ Scan ç®—å­æ‰«æçš„æ€»æ•°æ®é‡ï¼ˆå­—èŠ‚ï¼‰
    pub total_scan_bytes: u64,
}
```

**æå–é€»è¾‘**ï¼š
- `backend_num`: ä»æ‰€æœ‰ Fragment çš„ `backend_addresses` ä¸­å»é‡ç»Ÿè®¡
- `total_scan_bytes`: ä»æ‰§è¡Œæ ‘ä¸­æ‰€æœ‰ SCAN èŠ‚ç‚¹çš„ `BytesRead` æŒ‡æ ‡ç´¯åŠ 

### 2.2 ClusterVariables - é›†ç¾¤å˜é‡

ä»é›†ç¾¤å®æ—¶è·å–çš„ä¼šè¯å˜é‡å€¼ï¼Œç”¨äºç²¾ç¡®åˆ¤æ–­å½“å‰å‚æ•°è®¾ç½®ã€‚

```rust
/// ä»é›†ç¾¤è·å–çš„å®é™…ä¼šè¯å˜é‡å€¼
pub type ClusterVariables = HashMap<String, String>;

/// åˆ†æä¸Šä¸‹æ–‡
pub struct AnalysisContext {
    /// é›†ç¾¤å®é™…å˜é‡å€¼ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
    pub cluster_variables: Option<ClusterVariables>,
}
```

**è·å–æ–¹å¼**ï¼š
```sql
SHOW VARIABLES WHERE Variable_name IN ('query_mem_limit', 'enable_spill', ...)
```

### 2.3 RuleContext - è§„åˆ™ä¸Šä¸‹æ–‡

è§„åˆ™è¯„ä¼°æ—¶çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ŒåŒ…å«æ™ºèƒ½æ¨èæ‰€éœ€çš„æ‰€æœ‰æ•°æ®ã€‚

```rust
pub struct RuleContext<'a> {
    /// å½“å‰è¯„ä¼°çš„æ‰§è¡Œæ ‘èŠ‚ç‚¹
    pub node: &'a ExecutionTreeNode,
    /// éé»˜è®¤ä¼šè¯å˜é‡ï¼ˆä» Profile è§£æï¼‰
    pub session_variables: &'a HashMap<String, SessionVariableInfo>,
    /// é›†ç¾¤ä¿¡æ¯ï¼ˆBE æ•°é‡ã€æ‰«ææ•°æ®é‡ç­‰ï¼‰
    pub cluster_info: Option<ClusterInfo>,
    /// é›†ç¾¤å®é™…å˜é‡å€¼ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
    pub cluster_variables: Option<&'a HashMap<String, String>>,
}
```

**å˜é‡å€¼è·å–ä¼˜å…ˆçº§**ï¼š
1. `cluster_variables` - é›†ç¾¤å®é™…å€¼ï¼ˆæœ€å‡†ç¡®ï¼‰
2. `session_variables` - Profile ä¸­çš„éé»˜è®¤å€¼
3. `get_parameter_default()` - å·²çŸ¥é»˜è®¤å€¼

### 2.3 ParameterSuggestion - å‚æ•°å»ºè®®

```rust
pub struct ParameterSuggestion {
    pub name: String,           // å‚æ•°å
    pub param_type: ParameterType,  // Session æˆ– BE
    pub current: Option<String>,    // å½“å‰å€¼ï¼ˆå¦‚æœå·²è®¾ç½®ï¼‰
    pub recommended: String,        // æ¨èå€¼
    pub command: String,            // è®¾ç½®å‘½ä»¤
    pub description: String,        // å‚æ•°è¯´æ˜
    pub impact: String,             // é¢„æœŸå½±å“ï¼ˆå«åŠ¨æ€ç†ç”±ï¼‰
}
```

## 3. æ™ºèƒ½æ¨èç®—æ³•

### 3.1 æ¨èå†³ç­–æµç¨‹

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   è¯Šæ–­è§„åˆ™è§¦å‘   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   è·å–ä¸Šä¸‹æ–‡     â”‚
                    â”‚ - é›†ç¾¤ä¿¡æ¯       â”‚
                    â”‚ - å½“å‰å‚æ•°å€¼     â”‚
                    â”‚ - æŸ¥è¯¢ç‰¹å¾       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  è®¡ç®—æ¨èå€¼      â”‚
                    â”‚ (åŸºäºè§„åˆ™)       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   è·³è¿‡æ¡ä»¶æ£€æŸ¥   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚              â”‚              â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
       â”‚å½“å‰å€¼>=æ¨èå€¼â”‚ â”‚æ•°æ®é‡å¤ªå° â”‚ â”‚å·²å¯ç”¨/è®¾ç½®â”‚
       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
              â”‚              â”‚              â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  æ»¡è¶³è·³è¿‡æ¡ä»¶?   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Yes                         â”‚ No
       â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   ä¸æ¨è    â”‚              â”‚  ç”Ÿæˆå»ºè®®      â”‚
       â”‚  (è¿”å›None) â”‚              â”‚ (å«åŠ¨æ€ç†ç”±)   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å‚æ•°æ¨èè§„åˆ™

#### 3.2.1 å¹¶è¡Œåº¦ç›¸å…³

| å‚æ•° | æ¨èé€»è¾‘ | è·³è¿‡æ¡ä»¶ |
|------|---------|---------|
| `parallel_fragment_exec_instance_num` | `min(BEæ•°é‡, 16)` | å½“å‰å€¼ >= æ¨èå€¼ æˆ– æ•°æ®é‡ < 100MB |
| `pipeline_dop` | `0` (auto) | å½“å‰å€¼ = 0 |
| `io_tasks_per_scan_operator` | å¤§æ•°æ®é‡(>1GB)æ¨è`8` | å½“å‰å€¼ >= æ¨èå€¼ æˆ– æ•°æ®é‡ <= 1GB |

**ç¤ºä¾‹**ï¼š
```
é›†ç¾¤: 8 BE èŠ‚ç‚¹
ç”¨æˆ·è®¾ç½®: parallel_fragment_exec_instance_num = 32
æ¨èå€¼: min(8, 16) = 8
åˆ¤æ–­: 32 >= 8 â†’ ä¸æ¨è
```

#### 3.2.2 å†…å­˜ç›¸å…³

| å‚æ•° | æ¨èé€»è¾‘ | è·³è¿‡æ¡ä»¶ |
|------|---------|---------|
| `query_mem_limit` | `2 Ã— æ‰«ææ•°æ®é‡`, min 4GB, max 32GB | å½“å‰å€¼ >= æ¨èå€¼ |
| `enable_spill` | `true` | å·²å¯ç”¨ |

**ç¤ºä¾‹**ï¼š
```
æ‰«ææ•°æ®é‡: 5GB
æ¨èå€¼: min(max(5GB Ã— 2, 4GB), 32GB) = 10GB
åŠ¨æ€ç†ç”±: "æ ¹æ®æ•°æ®é‡æ¨è 10GB å†…å­˜é™åˆ¶"
```

#### 3.2.3 æŸ¥è¯¢ä¼˜åŒ–

| å‚æ•° | æ¨èé€»è¾‘ | è·³è¿‡æ¡ä»¶ |
|------|---------|---------|
| `query_timeout` | `600` | å½“å‰å€¼ >= 600 |
| `enable_query_cache` | `true` | å·²å¯ç”¨ |

#### 3.2.4 Runtime Filter

| å‚æ•° | æ¨èé€»è¾‘ | è·³è¿‡æ¡ä»¶ |
|------|---------|---------|
| `enable_global_runtime_filter` | `true` | å·²å¯ç”¨ |
| `runtime_join_filter_push_down_limit` | `10000000` | å½“å‰å€¼ >= 10M |

#### 3.2.5 DataCache

| å‚æ•° | æ¨èé€»è¾‘ | è·³è¿‡æ¡ä»¶ |
|------|---------|---------|
| `enable_scan_datacache` | `true` | å·²å¯ç”¨ |
| `enable_populate_datacache` | `true` | å·²å¯ç”¨ |

#### 3.2.6 Profile æ”¶é›†

| å‚æ•° | æ¨èé€»è¾‘ | è·³è¿‡æ¡ä»¶ |
|------|---------|---------|
| `pipeline_profile_level` | `1` | å½“å‰å€¼ <= 1 |

#### 3.2.7 BE å‚æ•°

| å‚æ•° | æ¨èé€»è¾‘ | è·³è¿‡æ¡ä»¶ |
|------|---------|---------|
| `storage_page_cache_limit` | `30%` | IO ç“¶é¢ˆæ—¶æ¨è |

## 4. å®ç°ç»†èŠ‚

### 4.1 æ ¸å¿ƒæ–¹æ³•ï¼š`suggest_parameter_smart`

```rust
pub fn suggest_parameter_smart(&self, name: &str) -> Option<ParameterSuggestion> {
    let cluster_info = self.cluster_info.as_ref();
    
    // 1. è·å–å½“å‰å€¼ï¼ˆç”¨æˆ·è®¾ç½®æˆ–é»˜è®¤å€¼ï¼‰
    let current_str = self.get_variable_value(name);
    let default_str = get_parameter_default(name).map(|s| s.to_string());
    let effective_value = current_str.as_ref().or(default_str.as_ref());
    
    // 2. æ ¹æ®å‚æ•°ç±»å‹è®¡ç®—æ¨èå€¼å’Œè·³è¿‡æ¡ä»¶
    let (recommended, reason, param_type) = match name {
        "parallel_fragment_exec_instance_num" => {
            let be_count = cluster_info.map(|c| c.backend_num).unwrap_or(1).max(1);
            let recommended = be_count.min(16) as i64;
            let current = current_i64.unwrap_or(1);
            
            // è·³è¿‡æ¡ä»¶
            if current >= recommended { return None; }
            if cluster_info.map(|c| c.total_scan_bytes < 100_000_000).unwrap_or(true) {
                return None;
            }
            
            (recommended.to_string(), 
             format!("æ ¹æ®é›†ç¾¤ {} ä¸ª BE èŠ‚ç‚¹æ¨è", be_count), 
             ParameterType::Session)
        }
        // ... å…¶ä»–å‚æ•°
    };
    
    // 3. ç”Ÿæˆå»ºè®®
    Some(ParameterSuggestion {
        name: name.to_string(),
        param_type,
        current: self.get_variable_value(name),
        recommended,
        command: format!("SET {} = {};", name, recommended),
        description: metadata.description,
        impact: format!("{} ({})", metadata.impact, reason),
    })
}
```

### 4.2 æŸ¥è¯¢çº§åˆ«æ¨èï¼š`suggest_query_parameter`

ç”¨äºæŸ¥è¯¢çº§åˆ«è§„åˆ™ï¼ˆå¦‚ Q001-Q009ï¼‰ï¼Œæ²¡æœ‰èŠ‚ç‚¹ä¸Šä¸‹æ–‡ä½†æœ‰å®Œæ•´ Profileã€‚

```rust
fn suggest_query_parameter(profile: &Profile, name: &str) -> Option<ParameterSuggestion> {
    let cluster_info = profile.get_cluster_info();
    
    // è·å–å½“å‰å€¼
    let current_str = profile.summary.non_default_variables.get(name)
        .map(|v| v.actual_value_str());
    
    // è®¡ç®—æ¨èå€¼ï¼ˆä¸ suggest_parameter_smart ç±»ä¼¼ï¼‰
    // ...
}
```

## 5. ä½¿ç”¨ç¤ºä¾‹

### 5.1 èŠ‚ç‚¹çº§åˆ«è§„åˆ™

```rust
// åœ¨ exchange.rs ä¸­
fn evaluate(&self, context: &RuleContext) -> Option<Diagnostic> {
    // ... è¯Šæ–­é€»è¾‘ ...
    
    Some(Diagnostic {
        // ...
        parameter_suggestions: {
            let mut suggestions = Vec::new();
            if let Some(s) = context.suggest_parameter_smart("parallel_fragment_exec_instance_num") {
                suggestions.push(s);
            }
            if let Some(s) = context.suggest_parameter_smart("pipeline_dop") {
                suggestions.push(s);
            }
            suggestions
        },
    })
}
```

### 5.2 æŸ¥è¯¢çº§åˆ«è§„åˆ™

```rust
// åœ¨ query.rs ä¸­
fn evaluate(&self, profile: &Profile) -> Option<QueryDiagnostic> {
    // ... è¯Šæ–­é€»è¾‘ ...
    
    Some(QueryDiagnostic {
        // ...
        parameter_suggestions: {
            let mut suggestions = Vec::new();
            if let Some(s) = suggest_query_parameter(profile, "query_timeout") {
                suggestions.push(s);
            }
            if let Some(s) = suggest_query_parameter(profile, "query_mem_limit") {
                suggestions.push(s);
            }
            suggestions
        },
    })
}
```

## 6. å‰ç«¯å±•ç¤º

### 6.1 API å“åº”æ ¼å¼

```json
{
  "parameter_suggestions": [
    {
      "name": "parallel_fragment_exec_instance_num",
      "param_type": "Session",
      "current": "1",
      "recommended": "8",
      "command": "SET parallel_fragment_exec_instance_num = 8;",
      "description": "æ¯ä¸ª Fragment çš„å¹¶è¡Œæ‰§è¡Œå®ä¾‹æ•°",
      "impact": "å¢å¤§å¯æå‡å¹¶è¡Œåº¦ï¼Œä½†ä¼šå ç”¨æ›´å¤šèµ„æº (æ ¹æ®é›†ç¾¤ 8 ä¸ª BE èŠ‚ç‚¹æ¨è)"
    }
  ]
}
```

### 6.2 UI å±•ç¤ºæ•ˆæœ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš™ï¸ parallel_fragment_exec_instance_num          [Session]   â”‚
â”‚   æ¯ä¸ª Fragment çš„å¹¶è¡Œæ‰§è¡Œå®ä¾‹æ•°                             â”‚
â”‚   ğŸ“ˆ å¢å¤§å¯æå‡å¹¶è¡Œåº¦ (æ ¹æ®é›†ç¾¤ 8 ä¸ª BE èŠ‚ç‚¹æ¨è)            â”‚
â”‚   å½“å‰å€¼: 1 â†’ æ¨èå€¼: 8                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ SET parallel_fragment_exec_instance_num = 8; [å¤åˆ¶] â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 7. æ‰©å±•æŒ‡å—

### 7.1 æ·»åŠ æ–°å‚æ•°

1. åœ¨ `get_parameter_default()` ä¸­æ·»åŠ é»˜è®¤å€¼
2. åœ¨ `get_parameter_metadata()` ä¸­æ·»åŠ æè¿°å’Œå½±å“è¯´æ˜
3. åœ¨ `suggest_parameter_smart()` ä¸­æ·»åŠ æ¨èé€»è¾‘

```rust
// 1. é»˜è®¤å€¼
"new_param" => Some("default_value"),

// 2. å…ƒæ•°æ®
"new_param" => ParameterMetadata {
    description: "å‚æ•°è¯´æ˜".to_string(),
    impact: "é¢„æœŸå½±å“".to_string(),
},

// 3. æ¨èé€»è¾‘
"new_param" => {
    let current = current_i64.unwrap_or(default);
    if current >= recommended { return None; }
    (recommended.to_string(), "æ¨èç†ç”±".to_string(), ParameterType::Session)
}
```

### 7.2 æ·»åŠ æ–°çš„è·³è¿‡æ¡ä»¶

åœ¨å‚æ•°çš„ match åˆ†æ”¯ä¸­æ·»åŠ é¢å¤–çš„æ¡ä»¶æ£€æŸ¥ï¼š

```rust
"param_name" => {
    // æ–°çš„è·³è¿‡æ¡ä»¶
    if some_condition {
        return None;
    }
    // ...
}
```

## 8. æµ‹è¯•

### 8.1 å•å…ƒæµ‹è¯•

```rust
#[test]
fn test_smart_recommendation_skips_when_current_exceeds() {
    let context = create_test_context_with_variable(
        "parallel_fragment_exec_instance_num", 
        "32"
    );
    let suggestion = context.suggest_parameter_smart("parallel_fragment_exec_instance_num");
    assert!(suggestion.is_none(), "Should skip when current >= recommended");
}
```

### 8.2 é›†æˆæµ‹è¯•

ä½¿ç”¨çœŸå® Profile æ–‡ä»¶æµ‹è¯•å®Œæ•´çš„åˆ†ææµç¨‹ï¼ŒéªŒè¯å‚æ•°æ¨èçš„æ­£ç¡®æ€§ã€‚

## 9. ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´ |
|------|------|------|
| 1.0 | 2025-12-05 | åˆå§‹ç‰ˆæœ¬ï¼Œæ”¯æŒ 13 ä¸ªå‚æ•°çš„æ™ºèƒ½æ¨è |
