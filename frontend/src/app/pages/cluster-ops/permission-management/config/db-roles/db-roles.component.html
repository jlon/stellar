<div class="row">
  <!-- Roles List Section -->
  <div class="col-12">
    <nb-card>
      <nb-card-header>
        <h6>数据库角色 - {{ filteredRoles.length }}</h6>
      </nb-card-header>

      <nb-card-body>
        <!-- Loading Spinner -->
        <div *ngIf="rolesLoading" class="text-center p-4">
          <nb-spinner></nb-spinner>
          <p>加载角色中...</p>
        </div>

        <!-- Roles Table -->
        <div *ngIf="!rolesLoading && filteredRoles.length > 0">
          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th>角色名</th>
                <th>角色类型</th>
                <th>权限数</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let role of filteredRoles">
                <td><strong>{{ role.role_name }}</strong></td>
                <td>
                  <span
                    class="badge"
                    [class.badge-danger]="role.role_type === 'built-in'"
                    [class.badge-warning]="role.role_type === 'custom'"
                  >
                    {{ getRoleTypeLabel(role.role_type) }}
                  </span>
                </td>
                <td><small>{{ role.permissions_count || 0 }}</small></td>
                <td>
                  <button
                    class="btn btn-sm btn-info"
                    (click)="onViewDetail(role)"
                  >
                    查看
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Empty State -->
        <div *ngIf="!rolesLoading && filteredRoles.length === 0" class="text-center p-4">
          <p class="text-muted">暂无角色</p>
        </div>
      </nb-card-body>
    </nb-card>
  </div>
</div>

<!-- Role Detail Modal -->
<nb-card *ngIf="selectedRole" class="detail-modal-overlay" (click)="onCloseDetail()">
  <div class="detail-modal-content" (click)="$event.stopPropagation()">
    <nb-card>
      <nb-card-header>
        <div class="d-flex justify-content-between align-items-center">
          <h6>角色详情: {{ selectedRole.role_name }}</h6>
          <button
            type="button"
            class="btn btn-sm btn-ghost"
            aria-label="关闭"
            (click)="onCloseDetail()"
          >
            ✕
          </button>
        </div>
      </nb-card-header>

      <nb-card-body>
        <!-- Role Info -->
        <div class="row mb-4">
          <div class="col-md-6">
            <label class="text-muted">角色名</label>
            <div><strong>{{ selectedRole.role_name }}</strong></div>
          </div>
          <div class="col-md-6">
            <label class="text-muted">角色类型</label>
            <div>
              <span
                class="badge"
                [class.badge-danger]="selectedRole.role_type === 'built-in'"
                [class.badge-warning]="selectedRole.role_type === 'custom'"
              >
                {{ getRoleTypeLabel(selectedRole.role_type) }}
              </span>
            </div>
          </div>
        </div>

        <!-- Permissions Count -->
        <div class="row mb-4">
          <div class="col-12">
            <label class="text-muted">权限数量</label>
            <div class="mt-2">
              <strong>{{ selectedRole.permissions_count || 0 }}</strong> 个权限
            </div>
          </div>
        </div>

        <!-- Close Button -->
        <div class="row">
          <div class="col-12">
            <button
              type="button"
              class="btn btn-secondary"
              (click)="onCloseDetail()"
            >
              关闭
            </button>
          </div>
        </div>
      </nb-card-body>
    </nb-card>
  </div>
</nb-card>

<style>
  .detail-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
  }

  .detail-modal-content {
    width: 90%;
    max-width: 700px;
    max-height: 90vh;
    overflow-y: auto;
    background: white;
    border-radius: 4px;
  }

  .permission-tree {
    .permission-item {
      padding: 0.5rem 0;
      font-size: 0.9rem;

      code {
        background-color: #f8f9fa;
        padding: 0.2rem 0.4rem;
        border-radius: 0.25rem;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      }
    }
  }

  .badge {
    &-danger {
      background-color: #ff6b6b;
    }

    &-warning {
      background-color: #ffa94d;
    }
  }
</style>
