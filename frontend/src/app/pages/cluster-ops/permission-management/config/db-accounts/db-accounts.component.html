<div class="row">
  <!-- Accounts List Section -->
  <div class="col-12">
    <nb-card>
      <nb-card-header>
        <h6>数据库账户 - {{ filteredAccounts.length }}</h6>
      </nb-card-header>

      <nb-card-body>
        <!-- Loading Spinner -->
        <div *ngIf="accountsLoading" class="text-center p-4">
          <nb-spinner></nb-spinner>
          <p>加载账户中...</p>
        </div>

        <!-- Accounts Table -->
        <div *ngIf="!accountsLoading && filteredAccounts.length > 0">
          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th>账户名</th>
                <th>主机</th>
                <th>拥有角色</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let account of filteredAccounts">
                <td><strong>{{ account.account_name }}</strong></td>
                <td><code>{{ account.host }}</code></td>
                <td>
                  <span
                    *ngFor="let role of account.roles"
                    class="badge badge-light mr-1"
                  >
                    {{ role }}
                  </span>
                </td>
                <td>
                  <button
                    class="btn btn-sm btn-info"
                    (click)="onViewDetail(account)"
                  >
                    查看
                  </button>
                  <button
                    class="btn btn-sm btn-primary ml-1"
                    (click)="onRequestPermission(account)"
                  >
                    申请权限
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Empty State -->
        <div *ngIf="!accountsLoading && filteredAccounts.length === 0" class="text-center p-4">
          <p class="text-muted">暂无账户</p>
        </div>
      </nb-card-body>
    </nb-card>
  </div>
</div>

<!-- Account Detail Modal -->
<nb-card *ngIf="selectedAccount" class="detail-modal-overlay" (click)="onCloseDetail()">
  <div class="detail-modal-content" (click)="$event.stopPropagation()">
    <nb-card>
      <nb-card-header>
        <div class="d-flex justify-content-between align-items-center">
          <h6>账户详情: {{ selectedAccount.account_name }}</h6>
          <button
            type="button"
            class="btn btn-sm btn-ghost"
            aria-label="关闭"
            (click)="onCloseDetail()"
          >
            ✕
          </button>
        </div>
      </nb-card-header>

      <nb-card-body>
        <!-- Account Info -->
        <div class="row mb-3">
          <div class="col-md-6">
            <label class="text-muted">账户名</label>
            <div><strong>{{ selectedAccount.account_name }}</strong></div>
          </div>
          <div class="col-md-6">
            <label class="text-muted">主机</label>
            <div><code>{{ selectedAccount.host }}</code></div>
          </div>
        </div>

        <!-- Roles -->
        <div class="row mb-4">
          <div class="col-12">
            <label class="text-muted">拥有角色</label>
            <div class="mt-2">
              <span
                class="badge badge-info mr-2 mb-2"
                *ngFor="let role of selectedAccount.roles"
              >
                {{ role }}
              </span>
            </div>
          </div>
        </div>

        <!-- Close Button -->
        <div class="row">
          <div class="col-12">
            <button
              type="button"
              class="btn btn-secondary"
              (click)="onCloseDetail()"
            >
              关闭
            </button>
          </div>
        </div>
      </nb-card-body>
    </nb-card>
  </div>
</nb-card>

<style>
  .detail-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
  }

  .detail-modal-content {
    width: 90%;
    max-width: 700px;
    max-height: 90vh;
    overflow-y: auto;
    background: white;
    border-radius: 4px;
  }
</style>
