<div class="my-requests-container">
  <!-- 过滤器 -->
  <div class="row mb-3">
    <div class="col-md-4">
      <label>申请状态：</label>
      <select
        nbInput
        [(ngModel)]="filterStatus"
        (change)="onFilterChange()"
        class="form-control"
        [disabled]="loading"
      >
        <option *ngFor="let option of statusOptions" [value]="option.value">
          {{ option.label }}
        </option>
      </select>
    </div>
    <div class="col-md-4">
      <label>申请类型：</label>
      <select
        nbInput
        [(ngModel)]="filterType"
        (change)="onFilterChange()"
        class="form-control"
        [disabled]="loading"
      >
        <option *ngFor="let option of typeOptions" [value]="option.value">
          {{ option.label }}
        </option>
      </select>
    </div>
  </div>

  <!-- 加载中状态 -->
  <div *ngIf="loading" class="text-center py-5">
    <nb-spinner status="primary"></nb-spinner>
    <p class="mt-3 text-muted">加载中...</p>
  </div>

  <!-- 错误状态 -->
  <nb-alert *ngIf="error && !loading" status="danger" closable="false" class="mb-3">
    <p class="alert-title">
      <nb-icon icon="alert-circle-outline"></nb-icon>
      加载失败
    </p>
    <p>{{ error }}</p>
    <button nbButton size="small" status="danger" (click)="retry()" class="mt-2">
      <nb-icon icon="refresh-outline"></nb-icon>
      重试
    </button>
  </nb-alert>

  <!-- 空状态 -->
  <nb-card *ngIf="isEmpty && !loading && !error" class="text-center py-5">
    <nb-card-body>
      <nb-icon icon="inbox-outline" size="giant" status="info"></nb-icon>
      <h4 class="mt-3">暂无权限申请</h4>
      <p class="text-muted">您还没有提交任何权限申请。<br />点击上面的"新建申请"按钮开始申请。</p>
    </nb-card-body>
  </nb-card>

  <!-- 数据表格 -->
  <ng2-smart-table
    *ngIf="!loading && !error && !isEmpty"
    [settings]="settings"
    [source]="source"
    [pagerDisplay]="'bottom'"
  >
    <!-- 自定义操作列 -->
    <ng2-smart-table-custom-action>
      <ng-template let-rowData [let-row]="rowData" ngxSmartTableCustomAction>
        <button
          nbButton
          ghost
          size="small"
          (click)="viewDetails(row)"
          title="查看详情"
        >
          <nb-icon icon="eye-outline"></nb-icon>
        </button>
        <button
          *ngIf="row.status === 'pending'"
          nbButton
          ghost
          status="danger"
          size="small"
          (click)="cancelRequest(row)"
          title="取消申请"
        >
          <nb-icon icon="trash-2-outline"></nb-icon>
        </button>
      </ng-template>
    </ng2-smart-table-custom-action>
  </ng2-smart-table>
</div>
