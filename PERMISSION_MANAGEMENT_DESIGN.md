# Stellar æƒé™ç®¡ç†ç³»ç»Ÿè®¾è®¡æ–‡æ¡£

> **è®¾è®¡ç‰ˆæœ¬**: v1.0
> **æœ€åæ›´æ–°**: 2025-12-20
> **è®¾è®¡è€…**: Claude + User
> **ç›®æ ‡**: æ”¯æŒ Doris + StarRocks æƒé™ç®¡ç†çš„ç»Ÿä¸€ç•Œé¢

---

## ğŸ“– ç›®å½•

1. [èƒŒæ™¯ä¸ç›®æ ‡](#èƒŒæ™¯ä¸ç›®æ ‡)
2. [æƒé™æ¨¡å‹æ¦‚è¿°](#æƒé™æ¨¡å‹æ¦‚è¿°)
3. [ç³»ç»Ÿæ¶æ„è®¾è®¡](#ç³»ç»Ÿæ¶æ„è®¾è®¡)
4. [æ•°æ®æ¨¡å‹è®¾è®¡](#æ•°æ®æ¨¡å‹è®¾è®¡)
5. [å‰ç«¯ç•Œé¢ç»“æ„](#å‰ç«¯ç•Œé¢ç»“æ„)
6. [æƒé™å·¥å•æµç¨‹](#æƒé™å·¥å•æµç¨‹)
7. [æƒé™é…ç½®ç®¡ç†](#æƒé™é…ç½®ç®¡ç†)
8. [äº¤äº’è®¾è®¡](#äº¤äº’è®¾è®¡)

---

## èƒŒæ™¯ä¸ç›®æ ‡

### é¡¹ç›®èƒŒæ™¯

Stellar æ˜¯ä¸€ä¸ªå¤šé›†ç¾¤ OLAP å¼•æ“ç®¡ç†å¹³å°ï¼Œéœ€è¦æ”¯æŒç®¡ç†å‘˜å¯¹ **StarRocks** å’Œ **Apache Doris** ä¸¤ç§æ•°æ®åº“çš„æƒé™è¿›è¡Œç»Ÿä¸€ç®¡ç†ã€‚

### æ ¸å¿ƒéœ€æ±‚

- âœ… æ”¯æŒæƒé™å·¥å•ï¼ˆç”³è¯·â†’å®¡æ‰¹â†’æ‰§è¡Œï¼‰å…¨æµç¨‹
- âœ… ç®¡ç†ç”¨æˆ·ã€è§’è‰²ã€æƒé™çš„ RBAC ä½“ç³»
- âœ… æŸ¥è¯¢æ•°æ®åº“è´¦æˆ·ã€è§’è‰²çš„å®æ—¶ä¿¡æ¯
- âœ… æ”¯æŒå¤šç§æƒé™ç²’åº¦ï¼ˆå…¨å±€ã€æ•°æ®åº“ã€è¡¨ã€åˆ—ï¼‰
- âœ… æ”¯æŒé›†ç¾¤éš”ç¦»ï¼ˆä¸åŒé›†ç¾¤çš„æƒé™ç‹¬ç«‹ç®¡ç†ï¼‰

### è®¾è®¡åŸåˆ™

1. **ç»Ÿä¸€æŠ½è±¡** - å°† Doris å’Œ StarRocks æƒé™å·®å¼‚ç»Ÿä¸€æˆé€šç”¨æ¨¡å‹
2. **æœ€å°åŒ–** - åªå®ç° MVP æ‰€éœ€çš„åŠŸèƒ½ï¼Œé¿å…è¿‡åº¦è®¾è®¡
3. **å¯æ‰©å±•** - ä¾¿äºåç»­æ‰©å±•æ”¯æŒå…¶ä»– OLAP å¼•æ“
4. **èŒè´£åˆ†ç¦»** - å·¥å•ç®¡ç†å’Œæƒé™é…ç½®æ˜ç¡®åˆ†ç•Œ

---

## æƒé™æ¨¡å‹æ¦‚è¿°

### Doris æƒé™æ¨¡å‹

#### æƒé™å±‚çº§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å…¨å±€çº§åˆ« (Global)                           â”‚
â”‚ â”œâ”€ Admin_priv  (è¶…çº§ç®¡ç†å‘˜æƒé™)            â”‚
â”‚ â”œâ”€ Node_priv   (èŠ‚ç‚¹ç®¡ç†æƒé™)              â”‚
â”‚ â”œâ”€ Grant_priv  (æƒé™æˆäºˆæƒé™)              â”‚
â”‚ â””â”€ ...                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ•°æ®ç›®å½•çº§åˆ« (Catalog)                     â”‚
â”‚ â”œâ”€ Select_priv, Load_priv, Alter_priv     â”‚
â”‚ â””â”€ ...                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ•°æ®åº“çº§åˆ« (Database)                      â”‚
â”‚ â”œâ”€ åŒ Catalog æƒé™                         â”‚
â”‚ â””â”€ ...                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¡¨çº§åˆ« (Table)                              â”‚
â”‚ â”œâ”€ Select_priv, Load_priv, Alter_priv     â”‚
â”‚ â””â”€ ...                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åˆ—çº§åˆ« (Column)                             â”‚
â”‚ â””â”€ Select_priv only                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ èµ„æºçº§åˆ« (Resource)                        â”‚
â”‚ â””â”€ Usage_priv                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æƒé™ç±»å‹ï¼ˆ9 ç§ï¼‰

| æƒé™ | è¯´æ˜ | å±‚çº§ |
|------|------|------|
| `Admin_priv` | è¶…çº§ç®¡ç†å‘˜æƒé™ | å…¨å±€ |
| `Node_priv` | èŠ‚ç‚¹ç®¡ç†æƒé™ï¼ˆadd/drop èŠ‚ç‚¹ï¼‰| å…¨å±€ |
| `Grant_priv` | æƒé™æˆäºˆæƒé™ | å…¨å±€ã€æ•°æ®ç›®å½•ã€æ•°æ®åº“ã€è¡¨ |
| `Select_priv` | æŸ¥è¯¢æƒé™ | Catalogã€DBã€Tableã€Column |
| `Load_priv` | æ•°æ®å¯¼å…¥æƒé™ | Catalogã€DBã€Table |
| `Alter_priv` | ä¿®æ”¹æƒé™ | Catalogã€DBã€Table |
| `Create_priv` | åˆ›å»ºæƒé™ | Catalogã€DB |
| `Drop_priv` | åˆ é™¤æƒé™ | Catalogã€DBã€Table |
| `Usage_priv` | èµ„æºä½¿ç”¨æƒé™ | Resource |

#### è§’è‰²

- **å†…ç½®è§’è‰²**: `operator`ï¼ˆæ‹¥æœ‰ Admin_priv + Node_privï¼‰ã€`admin`ï¼ˆæ‹¥æœ‰ Admin_privï¼‰
- **è‡ªå®šä¹‰è§’è‰²**: ä»»æ„å‘½åï¼Œå¯ä»¥ç‹¬ç«‹æˆæƒ
- **æ¨¡å‹**: RBACï¼Œç”¨æˆ·é€šè¿‡è§’è‰²è·å¾—æƒé™

---

### StarRocks æƒé™æ¨¡å‹

#### å†…ç½®è§’è‰²ï¼ˆ5 ç§ï¼Œä¸å¯å˜ï¼‰

| è§’è‰² | èŒè´£ | æƒé™èŒƒå›´ |
|------|------|---------|
| `db_admin` | æ•°æ®åº“ç®¡ç†å‘˜ | æ‰€æœ‰æ•°æ®ç›¸å…³æƒé™ + åŸºæœ¬è¿ç»´æƒé™ |
| `cluster_admin` | é›†ç¾¤ç®¡ç†å‘˜ | èŠ‚ç‚¹ç®¡ç†æƒé™ |
| `user_admin` | ç”¨æˆ·ç®¡ç†å‘˜ | ç”¨æˆ·ã€è§’è‰²ã€æƒé™ç®¡ç† |
| `security_admin` | å®‰å…¨ç®¡ç†å‘˜ | å®‰å…¨é…ç½®å’Œç­–ç•¥ç®¡ç† |
| `public` | å…¬å…±è§’è‰² | è‡ªåŠ¨æˆäºˆæ‰€æœ‰ç”¨æˆ·ï¼Œé»˜è®¤æ— æƒé™ |

#### æƒé™å±‚çº§

```
ç³»ç»Ÿçº§åˆ« (SYSTEM)
  â”œâ”€ NODE              (èŠ‚ç‚¹ç®¡ç†)
  â”œâ”€ GRANT             (æƒé™æˆäºˆ)
  â”œâ”€ CREATE RESOURCE GROUP
  â”œâ”€ CREATE EXTERNAL CATALOG
  â”œâ”€ PLUGIN
  â””â”€ REPOSITORY

Catalog çº§åˆ«
  â”œâ”€ USAGE             (è®¿é—®)
  â””â”€ CREATE DATABASE   (ä»…å†…éƒ¨ Catalog)

æ•°æ®åº“çº§åˆ« (DATABASE)
  â”œâ”€ ALTER
  â”œâ”€ DROP
  â”œâ”€ CREATE TABLE
  â”œâ”€ CREATE VIEW
  â””â”€ CREATE FUNCTION

è¡¨çº§åˆ« (TABLE)
  â”œâ”€ SELECT
  â”œâ”€ INSERT
  â”œâ”€ UPDATE
  â”œâ”€ DELETE
  â”œâ”€ ALTER
  â”œâ”€ EXPORT
  â””â”€ ALL

è§†å›¾/ç‰©åŒ–è§†å›¾çº§åˆ«
  â”œâ”€ SELECT
  â”œâ”€ ALTER            (ä»…è§†å›¾)
  â”œâ”€ REFRESH          (ä»…ç‰©åŒ–è§†å›¾)
  â””â”€ DROP
```

#### ç”¨æˆ·-è§’è‰²-æƒé™å…³ç³»

```
User (æœ€å¤š 64 ä¸ªè§’è‰²)
  â”œâ”€ Role1 (default)  â†’ Permissions
  â”œâ”€ Role2            â†’ Permissions
  â””â”€ RoleN

Role (å¯ç»§æ‰¿ 16 çº§)
  â”œâ”€ Parent Role1
  â”œâ”€ Parent Role2
  â””â”€ Direct Permissions
```

#### ç‰¹æ®Šæœºåˆ¶

- **WITH GRANT OPTION**: å…è®¸ç”¨æˆ·å°†æƒé™å†æˆäºˆç»™ä»–äºº
- **é»˜è®¤è§’è‰²**: è‡ªåŠ¨æ¿€æ´»ï¼›å¯é€šè¿‡ SET ROLE æ‰‹åŠ¨åˆ‡æ¢
- **æƒé™ç»§æ‰¿**: ç”¨æˆ·ä»æ‰€æœ‰è§’è‰²ç»§æ‰¿æƒé™ï¼ˆå¹¶é›†ï¼‰

---

## ç³»ç»Ÿæ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend (Angular SPA)                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚
â”‚ æƒé™ç®¡ç† (cluster-ops/permission-management)
â”‚   â”‚
â”‚   â”œâ”€ Permission Workbench (æƒé™å·¥å•)
â”‚   â”‚   â”œâ”€ My Requests      (æˆ‘çš„ç”³è¯·)
â”‚   â”‚   â””â”€ Approvals        (å¾…å®¡æ‰¹)
â”‚   â”‚
â”‚   â””â”€ Permission Config (æƒé™é…ç½®)
â”‚       â”œâ”€ System Users     (ç³»ç»Ÿç”¨æˆ·)
â”‚       â”œâ”€ System Roles     (ç³»ç»Ÿè§’è‰²)
â”‚       â”œâ”€ DB Accounts      (æ•°æ®åº“è´¦æˆ·)
â”‚       â””â”€ DB Roles         (æ•°æ®åº“è§’è‰²)
â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“â†‘ (HTTP/REST API)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend (Rust / Actix-web)                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚
â”‚ API Layer
â”‚   â”œâ”€ POST   /api/permission-requests           (æäº¤ç”³è¯·)
â”‚   â”œâ”€ GET    /api/permission-requests/my        (æŸ¥è¯¢æˆ‘çš„ç”³è¯·)
â”‚   â”œâ”€ GET    /api/permission-requests/pending   (æŸ¥è¯¢å¾…å®¡æ‰¹)
â”‚   â”œâ”€ POST   /api/permission-requests/:id/approve (æ‰¹å‡†)
â”‚   â”œâ”€ POST   /api/permission-requests/:id/reject  (æ‹’ç»)
â”‚   â”‚
â”‚   â”œâ”€ GET    /api/clusters/db-auth/accounts     (æŸ¥è¯¢è´¦æˆ·)
â”‚   â”œâ”€ GET    /api/clusters/db-auth/roles        (æŸ¥è¯¢è§’è‰²)
â”‚   â””â”€ POST   /api/db-auth/preview-sql           (é¢„è§ˆ SQL)
â”‚
â”‚ Business Logic Layer
â”‚   â”œâ”€ PermissionRequestService    (å·¥å•ç®¡ç†)
â”‚   â”œâ”€ DbAuthQueryService          (è´¦æˆ·/è§’è‰²æŸ¥è¯¢)
â”‚   â”œâ”€ PermissionSqlExecutor       (SQL æ‰§è¡Œ)
â”‚   â””â”€ ClusterService              (é›†ç¾¤ç®¡ç†)
â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“â†‘ (JDBC/MySQL Protocol)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OLAP Engines                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚
â”‚ StarRocks / Doris
â”‚   â”œâ”€ SQL Execution    (CREATE USER, GRANT, etc.)
â”‚   â””â”€ Metadata Query   (SELECT * FROM information_schema.*)
â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### èœå•ç»“æ„

```
é›†ç¾¤è¿ç»´ (cluster-ops)
â”‚
â”œâ”€ æ¦‚è§ˆ
â”œâ”€ èŠ‚ç‚¹ç®¡ç†
â”œâ”€ æŸ¥è¯¢ç®¡ç†
â”‚
â””â”€ æƒé™ç®¡ç† â˜… (æƒé™ç»Ÿä¸€èœå•)
   â”‚
   â”œâ”€ [æˆ‘çš„æƒé™]  (permission-dashboard)
   â”‚  â””â”€ æƒé™æ¦‚è§ˆ + æƒé™æ¸…å• + åˆ é™¤æƒé™
   â”‚
   â”œâ”€ [æƒé™ç”³è¯·]  (permission-request)
   â”‚  â””â”€ æ–°å»ºç”³è¯·è¡¨å• + æˆ‘çš„ç”³è¯·åˆ—è¡¨
   â”‚
   â””â”€ [æƒé™å®¡æ‰¹]  (permission-approval)
      â””â”€ å¾…å®¡æ‰¹åˆ—è¡¨ + æ‰¹å‡†/æ‹’ç»æ“ä½œ
```

**æ ¸å¿ƒåŸåˆ™ï¼š** æƒé™çš„å¢åˆ æ”¹å…¨éƒ¨é€šè¿‡ç”³è¯·å·¥å•æµç¨‹ï¼Œæ— ç›´æ¥ä¿®æ”¹æ¥å£ã€‚

---

## æ•°æ®æ¨¡å‹è®¾è®¡

### 1. æƒé™å·¥å•æ¨¡å‹ï¼ˆå·²å­˜åœ¨ï¼Œéœ€æ‰©å±•ï¼‰

#### PermissionRequest (æ•°æ®åº“å­˜å‚¨æ¨¡å‹)

```typescript
interface PermissionRequest {
  // åŸºæœ¬ä¿¡æ¯
  id: number;
  cluster_id: number;
  applicant_id: number;
  applicant_org_id: number;

  // ç”³è¯·å†…å®¹
  request_type: 'create_account' | 'grant_role' | 'grant_permission';
  request_details: RequestDetails;  // JSON
  reason: string;
  valid_until?: DateTime;

  // çŠ¶æ€
  status: 'pending' | 'approved' | 'rejected' | 'executing' | 'completed' | 'failed';

  // å®¡æ‰¹ä¿¡æ¯
  approver_id?: number;
  approval_comment?: string;
  approved_at?: DateTime;

  // æ‰§è¡Œç»“æœ
  executed_sql?: string;
  execution_result?: string;
  executed_at?: DateTime;

  // æ—¶é—´æˆ³
  created_at: DateTime;
  updated_at: DateTime;
}
```

#### RequestDetails (ç”³è¯·è¯¦æƒ… JSON)

```typescript
interface RequestDetails {
  action: 'create_account' | 'grant_role' | 'grant_permission';

  // é’ˆå¯¹ create_account
  target_account?: string;  // e.g., "user@'%'" æˆ– "user@'192.168.%'"

  // é’ˆå¯¹ grant_role / grant_permission
  target_user?: string;
  target_role?: string;

  // æƒé™èŒƒå›´
  scope: 'global' | 'database' | 'table' | 'column';
  database?: string;
  table?: string;
  column?: string;

  // æƒé™åˆ—è¡¨ï¼ˆæ ¹æ®æ•°æ®åº“ç±»å‹å¡«å……ï¼‰
  permissions: string[];  // ['SELECT', 'INSERT', ...] æˆ– ['Select_priv', 'Load_priv']

  // StarRocks ç‰¹æœ‰
  with_grant_option?: boolean;

  // ç”Ÿæˆçš„ SQLï¼ˆé¢„è§ˆï¼‰
  preview_sql?: string;
}
```

### 2. ç”¨æˆ·æ¨¡å‹æ‰©å±•

#### SystemUser (ç³»ç»Ÿç”¨æˆ·)

```typescript
interface SystemUser {
  id: number;
  username: string;
  email: string;
  is_super_admin: boolean;

  // ç»„ç»‡éš”ç¦»
  organization_id: number;

  // è§’è‰²
  roles: SystemRole[];  // ç³»ç»Ÿè§’è‰²å…³è”

  created_at: DateTime;
  updated_at: DateTime;
}
```

### 3. è§’è‰²æ¨¡å‹æ‰©å±•

#### SystemRole (ç³»ç»Ÿè§’è‰²)

```typescript
interface SystemRole {
  id: number;
  name: string;
  description: string;

  // åŒºåˆ†å†…ç½®å’Œè‡ªå®šä¹‰
  is_builtin: boolean;

  // æƒé™
  permissions: Permission[];

  // æˆå‘˜
  users: SystemUser[];

  created_at: DateTime;
  updated_at: DateTime;
}
```

### 4. æƒé™æ¨¡å‹

#### Permission (æƒé™)

```typescript
interface Permission {
  id: number;
  code: string;        // å”¯ä¸€æ ‡è¯†ï¼Œå¦‚ "api:db-auth:accounts:list"
  name: string;
  description: string;

  // æƒé™æ¥æºï¼ˆç”¨äºåŒºåˆ†ç³»ç»Ÿæƒé™ vs æ•°æ®åº“æƒé™ï¼‰
  source: 'system' | 'database';

  // æ•°æ®åº“æƒé™çš„é¢å¤–å±æ€§
  database_type?: 'doris' | 'starrocks';
  privilege_name?: string;  // Doris: Admin_priv, StarRocks: SELECT, etc.
  privilege_level?: 'global' | 'database' | 'table' | 'column';

  created_at: DateTime;
}
```

### 5. æ•°æ®åº“è´¦æˆ·/è§’è‰²æ¨¡å‹

#### DbAccount (æ•°æ®åº“è´¦æˆ·ï¼Œä»æ•°æ®åº“åŠ¨æ€æŸ¥è¯¢)

```typescript
interface DbAccount {
  account_name: string;
  host: string;
  roles: string[];  // æ‹¥æœ‰çš„è§’è‰²

  // é¢å¤–ä¿¡æ¯
  created_at?: DateTime;
  last_login?: DateTime;
}
```

#### DbRole (æ•°æ®åº“è§’è‰²ï¼Œä»æ•°æ®åº“åŠ¨æ€æŸ¥è¯¢)

```typescript
interface DbRole {
  role_name: string;
  role_type: 'built-in' | 'custom';

  // å¦‚æœèƒ½æŸ¥è¯¢åˆ°çš„è¯
  permissions?: DbPermission[];
  members?: DbAccount[];
}

interface DbPermission {
  privilege_name: string;
  privilege_level: 'global' | 'database' | 'table' | 'column';
  database?: string;
  table?: string;
}
```

---

## å‰ç«¯ç•Œé¢è®¾è®¡

### Tab 1: æˆ‘çš„æƒé™ï¼ˆPermission Dashboardï¼‰

**è®¾è®¡æ–¹æ¡ˆBï¼šå¡ç‰‡ä»ªè¡¨æ¿**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æˆ‘çš„æƒé™                              [åˆ·æ–°] [ç”³è¯·æƒé™] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚ ç”¨æˆ·: analyst_user   [è¯¦ç»†ä¿¡æ¯]                      â”‚
â”‚                                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚ æ‹¥æœ‰è§’è‰² â”‚ â”‚ å…¨å±€æƒé™ â”‚ â”‚ DBæƒé™  â”‚ â”‚ Tableæƒé™ â”‚       â”‚
â”‚ â”‚   3ä¸ª   â”‚ â”‚   2ä¸ª   â”‚ â”‚  10ä¸ª  â”‚ â”‚   15ä¸ª   â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ æƒé™æ¸…å• (æœç´¢) [è¿‡æ»¤â–¼]                           â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ æƒé™ç±»å‹ â”‚ èµ„æºèŒƒå›´        â”‚ å½’å±è§’è‰² â”‚ æ“ä½œ    â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ USAGE    â”‚ default_catalog â”‚ db_admin â”‚ [æ’¤é”€]  â”‚ â”‚
â”‚ â”‚ SELECT   â”‚ my_db.t1        â”‚ db_admin â”‚ [æ’¤é”€]  â”‚ â”‚
â”‚ â”‚ INSERT   â”‚ my_db.t1        â”‚ db_admin â”‚ [æ’¤é”€]  â”‚ â”‚
â”‚ â”‚ ALTER    â”‚ my_db           â”‚ db_admin â”‚ [æ’¤é”€]  â”‚ â”‚
â”‚ â”‚ SELECT   â”‚ public          â”‚ user     â”‚ [æ’¤é”€]  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- âœ… å±•ç¤ºå½“å‰ç”¨æˆ·çš„æ‰€æœ‰æƒé™ï¼ˆæŒ‰è§’è‰²åˆ†ç»„ï¼‰
- âœ… æ”¯æŒæœç´¢å’Œè¿‡æ»¤æƒé™
- âœ… **æ’¤é”€æƒé™æŒ‰é’®** â†’ è·³è½¬åˆ°æƒé™ç”³è¯·ï¼Œé¢„å¡« `revoke_permission` è¯·æ±‚

---

### Tab 2: æƒé™ç”³è¯·ï¼ˆPermission Requestï¼‰

**ä¸ŠåŠéƒ¨åˆ†ï¼šæ–°å»ºç”³è¯·è¡¨å•**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–°å»ºæƒé™ç”³è¯·                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚ * ç”³è¯·ç±»å‹  [æˆäºˆè§’è‰² â–¼]  (3ä¸ªé€‰é¡¹)                   â”‚
â”‚             â”œâ”€ æˆäºˆè§’è‰²                               â”‚
â”‚             â”œâ”€ æˆäºˆæƒé™                               â”‚
â”‚             â””â”€ æ’¤é”€æƒé™                               â”‚
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ è¡¨å•å†…å®¹æ ¹æ®ç”³è¯·ç±»å‹åŠ¨æ€å˜åŒ–                      â”‚  â”‚
â”‚  â”‚                                                   â”‚  â”‚
â”‚  â”‚ é€‰æ‹©ç”¨æˆ·:    [analyst_user â–¼]                   â”‚  â”‚
â”‚  â”‚ + åˆ›å»ºæ–°ç”¨æˆ· (å¦‚æ— åˆé€‚ç”¨æˆ·)                      â”‚  â”‚
â”‚  â”‚                                                   â”‚  â”‚
â”‚  â”‚ é€‰æ‹©è§’è‰²:    [db_admin â–¼]                      â”‚  â”‚
â”‚  â”‚ + åˆ›å»ºæ–°è§’è‰² (å¦‚æ— åˆé€‚è§’è‰²)                      â”‚  â”‚
â”‚  â”‚                                                   â”‚  â”‚
â”‚  â”‚ ç”³è¯·ç†ç”±:    [è¯·è¯¦ç»†è¯´æ˜ç”³è¯·æƒé™çš„ç†ç”±...]       â”‚  â”‚
â”‚  â”‚                                                   â”‚  â”‚
â”‚  â”‚ SQLé¢„è§ˆ:                                         â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚ â”‚ GRANT db_admin TO analyst_user             â”‚  â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                   â”‚  â”‚
â”‚  â”‚ [æäº¤ç”³è¯·] [é‡ç½®]                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æˆ‘çš„ç”³è¯·åˆ—è¡¨                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚ [æœç´¢] [çŠ¶æ€è¿‡æ»¤: å…¨éƒ¨â–¼]                              â”‚
â”‚                                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ ID â”‚ ç”³è¯·ç±»å‹  â”‚ ç›®æ ‡    â”‚ çŠ¶æ€  â”‚ åˆ›å»ºæ—¶é—´   â”‚ æ“ä½œâ”‚  â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ â”‚ 10 â”‚ æˆäºˆè§’è‰²  â”‚ user1  â”‚ æ‰§è¡Œä¸­â”‚ 2025-12-20â”‚[æŸ¥çœ‹]â”‚  â”‚
â”‚ â”‚ 9  â”‚ æˆäºˆæƒé™  â”‚ user2  â”‚ å·²å®Œæˆâ”‚ 2025-12-19â”‚[æŸ¥çœ‹]â”‚  â”‚
â”‚ â”‚ 8  â”‚ æ’¤é”€æƒé™  â”‚ user3  â”‚ å¾…å®¡æ‰¹â”‚ 2025-12-18â”‚[æŸ¥çœ‹]â”‚  â”‚
â”‚ â”‚ 7  â”‚ æˆäºˆè§’è‰²  â”‚ user4  â”‚ å·²æ‹’ç»â”‚ 2025-12-17â”‚[æŸ¥çœ‹]â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¡¨å•åŠ¨æ€åŒ–ï¼š**

| ç”³è¯·ç±»å‹ | æ˜¾ç¤ºå­—æ®µ | SQLç”Ÿæˆ |
|---------|---------|--------|
| **æˆäºˆè§’è‰²** | ç”¨æˆ· / è§’è‰² | GRANT role TO user |
| **æˆäºˆæƒé™** | ç”¨æˆ· / èµ„æºç±»å‹ / Catalog / Database / Table / æƒé™åˆ—è¡¨ | GRANT perms ON resource TO user |
| **æ’¤é”€æƒé™** | ç”¨æˆ· / èµ„æºç±»å‹ / Catalog / Database / Table / æƒé™åˆ—è¡¨ | REVOKE perms ON resource FROM user |

---

### Tab 3: æƒé™å®¡æ‰¹ï¼ˆPermission Approvalï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¾…å®¡æ‰¹ç”³è¯·                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚ [æœç´¢] [ç”³è¯·ç±»å‹è¿‡æ»¤: å…¨éƒ¨â–¼]                          â”‚
â”‚                                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ ID â”‚ ç”³è¯·ç±»å‹  â”‚ ç”³è¯·äºº  â”‚ ç›®æ ‡   â”‚ åˆ›å»ºæ—¶é—´   â”‚ æ“ä½œ â”‚  â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ â”‚ 10 â”‚ æˆäºˆè§’è‰²  â”‚ user5  â”‚ user1  â”‚ 2025-12-20 â”‚[è¯¦æƒ…]â”‚  â”‚
â”‚ â”‚ 9  â”‚ æ’¤é”€æƒé™  â”‚ user6  â”‚ user2  â”‚ 2025-12-19 â”‚[è¯¦æƒ…]â”‚  â”‚
â”‚ â”‚ 8  â”‚ æˆäºˆæƒé™  â”‚ user7  â”‚ user3  â”‚ 2025-12-18 â”‚[è¯¦æƒ…]â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‚¹å‡»"è¯¦æƒ…"å¼¹çª—ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æƒé™ç”³è¯·è¯¦æƒ… (ID: 10)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                â”‚
â”‚ ç”³è¯·äºº:     user5                              â”‚
â”‚ ç”³è¯·ç±»å‹:   æˆäºˆè§’è‰²                           â”‚
â”‚ ç›®æ ‡ç”¨æˆ·:   user1                              â”‚
â”‚ ç›®æ ‡è§’è‰²:   db_admin                           â”‚
â”‚ ç”³è¯·ç†ç”±:   æå‡ç”¨æˆ·æƒé™ä»¥å®Œæˆæ•°æ®åˆ†æä»»åŠ¡     â”‚
â”‚ åˆ›å»ºæ—¶é—´:   2025-12-20 10:30:00               â”‚
â”‚                                                â”‚
â”‚ SQLé¢„è§ˆ:                                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ GRANT db_admin TO user1                  â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                â”‚
â”‚ å®¡æ‰¹æ„è§: [è¯·è¾“å…¥å®¡æ‰¹æ„è§...]                  â”‚
â”‚                                                â”‚
â”‚ [æ‰¹å‡†] [æ‹’ç»] [è¿”å›]                           â”‚
â”‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ç›®å½•ç»“æ„

```
frontend/src/app/pages/cluster-ops/
â””â”€ permission-management/               â˜… æ–°å¢
   â”œâ”€ permission-management-routing.module.ts
   â”œâ”€ permission-management.module.ts
   â”œâ”€ permission-management.component.ts        (ä¸»å®¹å™¨ï¼ŒTabç®¡ç†)
   â”œâ”€ permission-management.component.html
   â”‚
   â”œâ”€ dashboard/                                (æˆ‘çš„æƒé™)
   â”‚  â”œâ”€ permission-dashboard.component.*
   â”‚  â””â”€ shared/
   â”‚     â””â”€ permission-list.component.*         (æƒé™æ¸…å•è¡¨æ ¼)
   â”‚
   â”œâ”€ request/                                  (æƒé™ç”³è¯·)
   â”‚  â”œâ”€ permission-request.component.*
   â”‚  â”œâ”€ request-form.component.*              (åŠ¨æ€è¡¨å•)
   â”‚  â””â”€ request-list.component.*
   â”‚
   â”œâ”€ approval/                                 (æƒé™å®¡æ‰¹)
   â”‚  â”œâ”€ permission-approval.component.*
   â”‚  â””â”€ approval-detail-modal.component.*
   â”‚
   â””â”€ shared/                                   (å…±äº«ç»„ä»¶)
      â”œâ”€ sql-preview.component.*               (SQLé¢„è§ˆæ¡†)
      â”œâ”€ user-selector.component.*             (ç”¨æˆ·é€‰æ‹©å™¨)
      â”œâ”€ role-selector.component.*             (è§’è‰²é€‰æ‹©å™¨)
      â””â”€ resource-selector.component.*         (èµ„æºé€‰æ‹©å™¨)

æ ¸å¿ƒæœåŠ¡ï¼š
â””â”€ frontend/src/app/@core/data/
   â”œâ”€ permission-request.service.ts           (æƒé™å·¥å•API)
   â””â”€ permission-request.model.ts             (æ•°æ®æ¨¡å‹)
```

## æƒé™å·¥å•æµç¨‹

### å·¥å•ç±»å‹ï¼ˆ3ç§ï¼‰

æƒé™ç”³è¯·æ”¯æŒä»¥ä¸‹ä¸‰ç§æ“ä½œï¼š

```
1. æˆäºˆè§’è‰² (grant_role)
   SQL: GRANT role_name TO user_name

2. æˆäºˆæƒé™ (grant_permission)
   SQL: GRANT permission_list ON resource TO user_name

3. æ’¤é”€æƒé™ (revoke_permission) â˜… æ–°å¢
   SQL: REVOKE permission_list ON resource FROM user_name
```

### å·¥å•ç”Ÿå‘½å‘¨æœŸ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆ›å»ºç”³è¯· â”‚  (applicant)
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚ POST /api/permission-requests
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pending      â”‚  ç­‰å¾…å®¡æ‰¹
â”‚ (waiting)    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€ å®¡æ‰¹é€šè¿‡ [POST /api/permission-requests/:id/approve]
     â”‚   â†“
     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   â”‚ Approved â”‚
     â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚        â”‚
     â”‚        â†“
     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   â”‚ Executing    â”‚  (æ‰§è¡Œ GRANT/REVOKE SQL)
     â”‚   â”‚ (executing)  â”‚
     â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚        â”‚
     â”‚        â”œâ”€ æˆåŠŸ â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚        â”‚        â”‚ Completedâ”‚
     â”‚        â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚        â”‚
     â”‚        â””â”€ å¤±è´¥ â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                  â”‚ Failed â”‚
     â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â””â”€ æ‹’ç» [POST /api/permission-requests/:id/reject]
         â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Rejectedâ”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ”¯æŒçš„ç”³è¯·ç±»å‹è¯¦è§£

#### 1. æˆäºˆè§’è‰² (grant_role)

```typescript
{
  request_type: 'grant_role',
  request_details: {
    action: 'grant_role',
    target_user: 'analyst_user',      // è¢«æˆæƒç”¨æˆ·
    target_role: 'db_admin',           // æˆäºˆçš„è§’è‰²
    preview_sql: 'GRANT db_admin TO analyst_user'
  },
  reason: 'æå‡ç”¨æˆ·æƒé™ä»¥å®Œæˆæ•°æ®åˆ†æä»»åŠ¡'
}
```

**ç”Ÿæˆçš„SQLï¼ˆéœ€æ ¹æ®å¼•æ“é€‚é…ï¼‰:**
- StarRocks: `GRANT db_admin TO analyst_user`
- Doris: `GRANT db_admin TO 'analyst_user'@'%'`

---

#### 2. æˆäºˆæƒé™ (grant_permission)

```typescript
{
  request_type: 'grant_permission',
  request_details: {
    action: 'grant_permission',
    target_user: 'analyst_user',
    resource_type: 'database',         // Catalog / Database / Table / Column
    catalog: 'default_catalog',        // (optional)
    database: 'my_db',                 // (optional, depends on resource_type)
    table: 'my_table',                 // (optional, only for Table level)
    permissions: ['SELECT', 'INSERT'], // StarRocks: SELECT, INSERT, ...
                                       // Doris: Select_priv, Load_priv, ...
    preview_sql: 'GRANT SELECT, INSERT ON DATABASE my_db TO analyst_user'
  },
  reason: 'æˆäºˆæ•°æ®æŸ¥è¯¢å’Œå¯¼å…¥æƒé™'
}
```

**ç”Ÿæˆçš„SQL:**
- StarRocks: `GRANT SELECT, INSERT ON DATABASE my_db TO analyst_user`
- Doris: `GRANT SELECT_PRIV, LOAD_PRIV ON DATABASE my_db TO 'analyst_user'@'%'`

---

#### 3. æ’¤é”€æƒé™ (revoke_permission) â˜… æ–°å¢

```typescript
{
  request_type: 'revoke_permission',
  request_details: {
    action: 'revoke_permission',
    target_user: 'analyst_user',
    resource_type: 'database',
    catalog: 'default_catalog',
    database: 'my_db',
    permissions: ['INSERT'],           // æ’¤é”€å“ªäº›æƒé™
    preview_sql: 'REVOKE INSERT ON DATABASE my_db FROM analyst_user'
  },
  reason: 'ç”¨æˆ·ç¦»èŒï¼Œæ’¤é”€å¯¼å…¥æƒé™'
}
```

**ç”Ÿæˆçš„SQL:**
- StarRocks: `REVOKE INSERT ON DATABASE my_db FROM analyst_user`
- Doris: `REVOKE LOAD_PRIV ON DATABASE my_db FROM 'analyst_user'@'%'`

---

### æƒé™è¯·æ±‚æ•°æ®æ¨¡å‹ï¼ˆæ‰©å±•ï¼‰

```typescript
interface PermissionRequest {
  // åŸºæœ¬ä¿¡æ¯
  id: number;
  cluster_id: number;
  applicant_id: number;
  applicant_org_id: number;

  // ç”³è¯·å†…å®¹
  request_type: 'grant_role' | 'grant_permission' | 'revoke_permission';
  request_details: RequestDetails;
  reason: string;

  // çŠ¶æ€
  status: 'pending' | 'approved' | 'rejected' | 'executing' | 'completed' | 'failed';

  // å®¡æ‰¹ä¿¡æ¯
  approver_id?: number;
  approval_comment?: string;
  approved_at?: DateTime;

  // æ‰§è¡Œç»“æœ
  executed_sql?: string;        // å®é™…æ‰§è¡Œçš„SQL
  execution_result?: string;    // æ‰§è¡Œç»“æœï¼ˆsuccess / error messageï¼‰
  executed_at?: DateTime;

  created_at: DateTime;
  updated_at: DateTime;
}

interface RequestDetails {
  action: 'grant_role' | 'grant_permission' | 'revoke_permission';

  // é’ˆå¯¹ grant_role / grant_permission / revoke_permission
  target_user: string;
  target_role?: string;         // ä»… grant_role ä½¿ç”¨

  // é’ˆå¯¹ grant_permission / revoke_permission
  resource_type: 'catalog' | 'database' | 'table' | 'column';
  catalog?: string;
  database?: string;
  table?: string;
  column?: string;
  permissions: string[];        // æƒé™åˆ—è¡¨

  // é¢„è§ˆ SQL
  preview_sql?: string;
}
```

### æ•°æ®æµ

```
å‰ç«¯è¡¨å•
  â†“
PermissionRequestService.submitRequest()
  â†“
Backend POST /api/permission-requests
  â†“
PermissionRequestService.createRequest()  (ä¿å­˜åˆ°æ•°æ®åº“)
  â†“
ç”Ÿæˆ preview_sql å’Œ execution_sql
  â†“
è¿”å› PermissionRequestResponse
  â†“
å‰ç«¯æ˜¾ç¤ºç”³è¯·è¯¦æƒ… (å«å®¡æ‰¹å†å²)
```

---

## æƒé™é…ç½®ç®¡ç†

### ç³»ç»Ÿç”¨æˆ·ç®¡ç†

#### ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç³»ç»Ÿç”¨æˆ·                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚ [æœç´¢æ¡†] [è¿‡æ»¤: è§’è‰²] [æ’åº]                    â”‚
â”‚                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ID  â”‚ ç”¨æˆ·å â”‚ é‚®ç®±        â”‚ è§’è‰²   â”‚ æ“ä½œ â”‚   â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚ â”‚ 1   â”‚ admin â”‚ admin@...   â”‚ admin  â”‚ [è¯¦æƒ…]â”‚   â”‚
â”‚ â”‚ 2   â”‚ user1 â”‚ user1@...   â”‚ user   â”‚ [è¯¦æƒ…]â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‚¹å‡»"è¯¦æƒ…"** â†’ å¼¹çª—æ˜¾ç¤ºï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·è¯¦æƒ…: admin                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç”¨æˆ·å: admin                       â”‚
â”‚ é‚®ç®±: admin@example.com             â”‚
â”‚                                     â”‚
â”‚ ç³»ç»Ÿè§’è‰²:                            â”‚
â”‚  â˜‘ admin                            â”‚
â”‚  â˜‘ user                             â”‚
â”‚                                     â”‚
â”‚ æƒé™æ ‘:                              â”‚
â”‚  [æƒé™æ ‘å±•ç¤ºï¼Œåªè¯»]                 â”‚
â”‚                                     â”‚
â”‚ [å…³é—­] [ç¼–è¾‘è§’è‰²]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç³»ç»Ÿè§’è‰²ç®¡ç†

#### ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç³»ç»Ÿè§’è‰²                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚ [æœç´¢æ¡†]                                        â”‚
â”‚                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ è§’è‰²å â”‚ æè¿°         â”‚ æˆå‘˜æ•° â”‚ æ“ä½œ   â”‚   â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚ â”‚ admin  â”‚ ç®¡ç†å‘˜       â”‚ 2    â”‚ [è¯¦æƒ…]  â”‚   â”‚
â”‚ â”‚ user   â”‚ æ™®é€šç”¨æˆ·     â”‚ 10   â”‚ [è¯¦æƒ…]  â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‚¹å‡»"è¯¦æƒ…"** â†’ å¼¹çª—æ˜¾ç¤ºï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è§’è‰²è¯¦æƒ…: admin                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è§’è‰²å: admin                        â”‚
â”‚ æè¿°: ç³»ç»Ÿç®¡ç†å‘˜                     â”‚
â”‚ æ˜¯å¦å†…ç½®: æ˜¯                         â”‚
â”‚                                      â”‚
â”‚ æƒé™:                                â”‚
â”‚  â˜‘ api:clusters:list                â”‚
â”‚  â˜‘ api:users:create                 â”‚
â”‚  â˜‘ api:roles:update                 â”‚
â”‚  ...                                 â”‚
â”‚                                      â”‚
â”‚ æˆå‘˜:                                â”‚
â”‚  â€¢ admin (admin@example.com)        â”‚
â”‚  â€¢ superuser (su@example.com)       â”‚
â”‚                                      â”‚
â”‚ [å…³é—­]                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®åº“è´¦æˆ·ç®¡ç†ï¼ˆåªè¯»ï¼‰

#### ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ•°æ®åº“è´¦æˆ· (my-doris)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚ é›†ç¾¤: my-doris  [åˆ‡æ¢é›†ç¾¤]              â”‚
â”‚                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ è´¦æˆ·å â”‚ ä¸»æœº  â”‚ æ‹¥æœ‰è§’è‰² â”‚ æ“ä½œ  â”‚  â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ â”‚ root   â”‚ %     â”‚ admin    â”‚ [æŸ¥çœ‹] â”‚  â”‚
â”‚ â”‚ admin  â”‚ %.%.% â”‚ user     â”‚ [æŸ¥çœ‹] â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚
â”‚ [åˆ·æ–°] [ç”³è¯·æƒé™]                        â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‚¹å‡»"ç”³è¯·æƒé™"** â†’ è·³è½¬åˆ°"æƒé™å·¥å• â†’ æ–°å»ºç”³è¯·"ï¼Œé¢„å¡«ï¼š
- ç”³è¯·ç±»å‹: grant_permission
- ç›®æ ‡è´¦æˆ·: å·²é€‰ä¸­çš„è´¦æˆ·

### æ•°æ®åº“è§’è‰²ç®¡ç†ï¼ˆåªè¯»ï¼‰

#### ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ•°æ®åº“è§’è‰² (my-doris)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚ é›†ç¾¤: my-doris  [åˆ‡æ¢é›†ç¾¤]              â”‚
â”‚                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ è§’è‰²å  â”‚ è§’è‰²ç±»å‹ â”‚ æƒé™æ•° â”‚ æ“ä½œ â”‚  â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ â”‚ admin   â”‚ å†…ç½®     â”‚ 15    â”‚ [æŸ¥çœ‹] â”‚  â”‚
â”‚ â”‚ user    â”‚ å†…ç½®     â”‚ 8     â”‚ [æŸ¥çœ‹] â”‚  â”‚
â”‚ â”‚ custom1 â”‚ è‡ªå®šä¹‰   â”‚ 3     â”‚ [æŸ¥çœ‹] â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚
â”‚ [åˆ·æ–°]                                  â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‚¹å‡»"æŸ¥çœ‹"** â†’ å¼¹çª—æ˜¾ç¤ºè§’è‰²æƒé™æ¸…å•ï¼ˆåªè¯»ï¼‰

---

## äº¤äº’è®¾è®¡

### æ–°å»ºç”³è¯·æµç¨‹

```
[æƒé™å·¥å•] â†’ [+ æ–°å»ºç”³è¯·]
              â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ é€‰æ‹©ç”³è¯·ç±»å‹     â”‚
        â”‚ â—‹ åˆ›å»ºè´¦æˆ·      â”‚
        â”‚ â—‹ æˆäºˆè§’è‰²      â”‚ (åˆå§‹é¡µé¢)
        â”‚ â—‹ æˆäºˆæƒé™      â”‚
        â”‚ [ä¸‹ä¸€æ­¥]         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
        æ ¹æ®ç±»å‹åŠ è½½è¡¨å•
              â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ åˆ›å»ºè´¦æˆ·ç”³è¯·                  â”‚
        â”‚                              â”‚
        â”‚ è´¦æˆ·å: [_________]          â”‚
        â”‚ ä¸»æœº: [___________]          â”‚
        â”‚ å¯†ç : [___________]          â”‚
        â”‚ ç”³è¯·åŸå› : [_____...]         â”‚
        â”‚ ç”³è¯·æœ‰æ•ˆæœŸ: [_______]        â”‚
        â”‚                              â”‚
        â”‚ SQL é¢„è§ˆ:                     â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚ â”‚ CREATE USER ...         â”‚  â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚                              â”‚
        â”‚ [å–æ¶ˆ] [æäº¤]               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
        æäº¤åˆ°åç«¯ï¼Œè¿”å›ç”³è¯· ID
              â†“
        æ˜¾ç¤º"ç”³è¯·æˆåŠŸ"æç¤º + è·³è½¬åˆ°"æˆ‘çš„ç”³è¯·"
              â†“
        åˆ—è¡¨æ˜¾ç¤ºæ–°ç”³è¯·ï¼ˆpending çŠ¶æ€ï¼‰
```

### æƒé™æ ‘ç»„ä»¶

```typescript
// å°†æƒé™æŒ‰å±‚çº§ç»„ç»‡ï¼Œæ”¯æŒå±•å¼€/æŠ˜å 

æƒé™æ ‘ç»“æ„ç¤ºä¾‹ï¼ˆDorisï¼‰:
â”œâ”€ å…¨å±€æƒé™
â”‚  â”œâ”€ Admin_priv
â”‚  â”œâ”€ Node_priv
â”‚  â””â”€ Grant_priv
â”œâ”€ æ•°æ®åº“æƒé™
â”‚  â”œâ”€ Select_priv
â”‚  â”œâ”€ Load_priv
â”‚  â””â”€ Alter_priv
â””â”€ è¡¨çº§æƒé™
   â”œâ”€ Select_priv
   â””â”€ ...

æƒé™æ ‘ç»“æ„ç¤ºä¾‹ï¼ˆStarRocksï¼‰:
â”œâ”€ ç³»ç»Ÿæƒé™
â”‚  â”œâ”€ NODE
â”‚  â”œâ”€ GRANT
â”‚  â””â”€ CREATE RESOURCE GROUP
â”œâ”€ æ•°æ®åº“æƒé™
â”‚  â”œâ”€ ALTER
â”‚  â”œâ”€ DROP
â”‚  â””â”€ CREATE TABLE
â””â”€ è¡¨çº§æƒé™
   â”œâ”€ SELECT
   â”œâ”€ INSERT
   â”œâ”€ UPDATE
   â””â”€ DELETE
```

---

## å®ç°è·¯çº¿å›¾

### Phase 1: æƒé™å·¥å•æ¨¡å— (Week 1-2)

- [ ] æ‹†åˆ†èœå•ç»“æ„ï¼ˆåˆ›å»º permission-workbench å’Œ permission-configï¼‰
- [ ] è¿ç§»ç°æœ‰çš„ my-requests å’Œ pending-approvals ç»„ä»¶
- [ ] æ”¹è¿›å·¥å•è¡¨å•å’Œæµç¨‹

### Phase 2: æƒé™é…ç½®æ¨¡å— (Week 3-4)

- [ ] åˆ›å»ºç³»ç»Ÿç”¨æˆ·ç®¡ç†é¡µé¢ï¼ˆè°ƒç”¨ `/api/users`ï¼‰
- [ ] åˆ›å»ºç³»ç»Ÿè§’è‰²ç®¡ç†é¡µé¢ï¼ˆè°ƒç”¨ `/api/roles`ï¼‰
- [ ] åˆ›å»ºæƒé™æ ‘ç»„ä»¶ï¼ˆå±•ç¤ºæƒé™æ¸…å•ï¼‰
- [ ] ä¼˜åŒ–æ•°æ®åº“è´¦æˆ·å’Œè§’è‰²é¡µé¢

### Phase 3: åç«¯ API æ‰©å±• (Week 2-3, å¹¶è¡Œ)

- [ ] å®ç° `/api/users` ç«¯ç‚¹ï¼ˆåˆ—è¡¨ã€è¯¦æƒ…ï¼‰
- [ ] å®ç° `/api/roles` ç«¯ç‚¹ï¼ˆåˆ—è¡¨ã€è¯¦æƒ…ã€æƒé™ï¼‰
- [ ] æ‰©å±•æƒé™è¯·æ±‚ SQL ç”Ÿæˆé€»è¾‘
- [ ] å®ç°æƒé™æ‰§è¡Œå¼•æ“

### Phase 4: UI/UX ä¼˜åŒ– (Week 4)

- [ ] ç»Ÿä¸€è®¾è®¡è¯­è¨€å’Œäº¤äº’æ¨¡å¼
- [ ] æ·»åŠ ç©ºçŠ¶æ€å’ŒåŠ è½½çŠ¶æ€
- [ ] æ·»åŠ æ•°æ®éªŒè¯å’Œé”™è¯¯æç¤º
- [ ] ç¼–å†™ç”¨æˆ·æ–‡æ¡£

---

## æ€»ç»“

æœ¬æ–‡æ¡£è®¾è®¡äº†ä¸€ä¸ªæ”¯æŒ **Doris + StarRocks** æƒé™ç®¡ç†çš„ç»Ÿä¸€å‰ç«¯ç³»ç»Ÿï¼Œæ ¸å¿ƒåŒ…æ‹¬ï¼š

1. **æƒé™å·¥å•** - ç”³è¯·â†’å®¡æ‰¹â†’æ‰§è¡Œ çš„å®Œæ•´æµç¨‹
2. **æƒé™é…ç½®** - ç”¨æˆ·ã€è§’è‰²ã€æƒé™çš„ RBAC ç®¡ç†
3. **æ•°æ®åº“ç®¡ç†** - å®æ—¶æŸ¥è¯¢å’Œç®¡ç†æ•°æ®åº“è´¦æˆ·å’Œè§’è‰²

è®¾è®¡éµå¾ª **æœ€å°åŒ–åŸåˆ™**ï¼ˆåªåš MVPï¼‰ï¼Œä½†ä¿ç•™äº† **å¯æ‰©å±•æ€§**ï¼ˆä¾¿äºæ”¯æŒæ›´å¤š OLAP å¼•æ“ï¼‰ã€‚

